# .NET Core 3.0 Preview Known Issues

This document lists known issues for **.NET Core 3.0 Preview releases** which may be encountered during usage.

## ASP.NET Core

- **Referencing 3.0.0 MVC libraries don't work as intended**: There are several issues with referencing a 3.0.0 MVC library.

    * Razor pages will 404, 
    * ApplicationParts and factories will not be discoverable
    * Controllers will not be discoverable

    To workaround this issue do the following:

    * Add the helper method:
    ```C#
    private void Add30AssemblyWorkaround(Assembly referencedAssembly, ApplicationPartManager applicationPartManager)
    {
        var partFactory = ApplicationPartFactory.GetApplicationPartFactory(referencedAssembly);

        foreach (var part in partFactory.GetApplicationParts(referencedAssembly))
        {
            applicationPartManager.ApplicationParts.Add(part);
        }

        var relatedAssemblies = RelatedAssemblyAttribute.GetRelatedAssemblies(referencedAssembly, throwOnError: true);
        foreach (var assembly in relatedAssemblies)
        {
            partFactory = ApplicationPartFactory.GetApplicationPartFactory(assembly);
            foreach (var part in partFactory.GetApplicationParts(assembly))
            {
                applicationPartManager.ApplicationParts.Add(part);
            }
        }
    }
    ```

    * Modify your `services.AddMvc()` call in `Startup.cs`:
    ```C#
    services.AddMvc()
        .ConfigureApplicationPartManager(manager =>
        {
            var referencedAssembly = Assembly.Load("RCL");
            Add30AssemblyWorkaround(referencedAssembly, manager);
        })
        ...
    ```

- **Server-side Blazor app fails to run on non-Windows platforms**

    Running a server-side Blazor app on a non-Windows platform fails with the following error:

    ```
    System.InvalidOperationException: Could not load the embedded file manifest 'Microsoft.Extensions.FileProviders.Embedded.Manifest.xml' for assembly 'Microsoft.AspNetCore.Components.Server'.
    ```

    This will be addressed in the next preview update.

- **A request made to a CORS-enabled endpoint wihtout an origin header fails with an HTTP 500 error.**

    Possible workarounds include:

    1. Having a middleware that sets the value in `HttpContext.Items` after `UseCors()`

        ```C#
        app.UseCors();

        app.Use((context, next) =>
        {
            context.Items["__CorsMiddlewareInvoked"] = true;
            return next();
        });
        ```

    2. Disable the check in `EndpointRouting`:
    
        ```C#
        services.AddRouting(r => r.SuppressCheckForUnhandledSecurityMetadata = true);
        ```

    The first option would be preferred since it's not removing a check for a mis-configured application.

